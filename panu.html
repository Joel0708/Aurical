<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panu - Merch and Gifts</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
        body {
            box-sizing: border-box;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .product-card:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(222, 184, 135, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .product-card:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.4);
            color: white;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .btn-primary:hover {
            background: rgba(222, 184, 135, 0.9);
            color: #1a1a1a;
        }
        
        .btn-primary:active {
            transform: scale(0.95);
        }
        
        .category-btn {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            color: #2d2d2d;
            transition: all 0.3s ease;
            min-height: 44px;
            min-width: 44px;
        }
        
        .category-btn.active {
            background: rgba(222, 184, 135, 0.9);
            color: #1a1a1a;
            border-color: rgba(222, 184, 135, 0.6);
        }
        
        .category-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(222, 184, 135, 0.5);
        }
        
        .category-btn:active {
            transform: scale(0.95);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px 12px 0 0;
        }
        
        .gallery-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            min-width: 44px;
            min-height: 44px;
        }
        
        .gallery-image.active {
            border-color: #8B4513;
        }
        
        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            margin: 1rem;
            max-height: calc(100vh - 2rem);
        }
        
        .loading-spinner {
            border: 3px solid #F5F5DC;
            border-top: 3px solid #8B4513;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .price-tag {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.4);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .unavailable-overlay {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 12px 12px 0 0;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            padding-left: 3rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            border-radius: 25px;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(222, 184, 135, 0.6);
            box-shadow: 0 0 0 3px rgba(222, 184, 135, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #8B4513;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            color: white;
        }
        
        .whatsapp-btn {
            background: linear-gradient(135deg, #25d366, #128c7e);
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .whatsapp-btn:active {
            transform: scale(0.9);
        }
        
        .view-btn {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            color: #2d2d2d;
            min-height: 44px;
        }
        
        .view-btn.active {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-color: rgba(222, 184, 135, 0.4);
        }
        
        .product-list-item {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(222, 184, 135, 0.3);
            transition: all 0.3s ease;
        }
        
        .product-list-item:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(222, 184, 135, 0.5);
        }
        
        .product-list-item:active {
            transform: scale(0.98);
        }
        
        .favorite-btn {
            transition: all 0.3s ease;
            min-width: 44px;
            min-height: 44px;
        }
        
        .favorite-btn.active {
            color: #dc2626;
        }
        
        .comparison-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(222, 184, 135, 0.4);
        }
        
        .floating-tools {
            position: fixed;
            bottom: 80px;
            right: 1rem;
            z-index: 40;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .tool-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(222, 184, 135, 0.4);
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .tool-btn:active {
            transform: scale(0.9);
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin: 0 auto 15px auto;
        }

        .logo-container img {
            width: 45px;
            height: 45px;
            object-fit: contain;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
            background: white;
            border-radius: 50%;
            padding: 6px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Mobile-first responsive design */
        @media (max-width: 640px) {
            .hero-section {
                padding: 1.5rem 0;
            }
            
            .hero-section h2 {
                font-size: 2rem !important;
            }
            
            .hero-section p {
                font-size: 1.1rem !important;
            }
            
            .stats-card {
                padding: 1rem;
            }
            
            .product-card {
                margin-bottom: 1rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                max-height: calc(100vh - 1rem);
                border-radius: 12px;
            }
            
            .price-tag {
                font-size: 0.8em;
                padding: 4px 8px;
            }
            
            .floating-tools {
                bottom: 70px;
                right: 0.5rem;
            }
            
            .tool-btn {
                width: 44px;
                height: 44px;
                font-size: 1rem;
            }
            
            .comparison-panel {
                padding: 0.75rem;
            }
            
            .gallery-image {
                width: 44px;
                height: 44px;
            }
        }

        /* Enterprise section styles */
        .enterprise-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
        }
        
        .enterprise-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(245, 245, 220, 0.2);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .enterprise-card:active {
            transform: scale(0.98);
        }

        /* Tab navigation */
        .tab-nav {
            border-bottom: 2px solid #e5e7eb;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-btn {
            min-width: 120px;
            padding: 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 44px;
        }
        
        .tab-btn.active {
            border-bottom-color: #8B4513;
            background: rgba(139, 69, 19, 0.1);
            color: #8B4513;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Improved touch targets */
        button, .btn, .category-btn, .tool-btn, .favorite-btn {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Better text readability on mobile */
        @media (max-width: 640px) {
            body {
                font-size: 16px;
                line-height: 1.5;
            }
            
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.5rem; }
            h3 { font-size: 1.25rem; }
            
            .text-xs { font-size: 0.875rem; }
            .text-sm { font-size: 0.9375rem; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-stone-50"><!-- Header -->
  <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
   <div class="max-w-7xl mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
     <div class="flex items-center space-x-4"><img src="https://aurical.org/images/PanuLogo.png" alt="Panu Logo" class="header-logo" onerror="this.style.display='none';">
      <div>
       <h1 class="text-3xl font-bold">Panu</h1>
       <p class="text-sm opacity-90">merch and gifts</p>
      </div>
     </div><!-- Search Bar -->
     <div class="search-container hidden md:block">
      <div class="search-icon">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
       </svg>
      </div><input type="text" id="search-input" placeholder="Buscar productos..." class="search-input w-80 py-3 pr-4 text-gray-800 focus:outline-none">
     </div>
     <div class="flex items-center space-x-4"><button onclick="toggleSearch()" class="md:hidden p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
       </svg></button> <span id="product-count" class="text-sm opacity-90">0 productos</span>
     </div>
    </div><!-- Mobile Search -->
    <div id="mobile-search" class="mt-4 hidden md:hidden">
     <div class="search-container">
      <div class="search-icon">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
       </svg>
      </div><input type="text" id="mobile-search-input" placeholder="Buscar productos..." class="search-input w-full py-3 pr-4 text-gray-800 focus:outline-none">
     </div>
    </div>
   </div>
  </header><!-- Hero Section -->
<!-- 🔥 INICIO SECCIÓN PROMOCIÓN -->
<section id="promotion-section" class="hidden">
  <div id="promotion-content" class="promotion-banner fade-in"></div>
</section>

<style>
  /* --- ESTILOS PROMOCIÓN SIMPLIFICADA --- */
  .promotion-banner {
    background: linear-gradient(135deg, #8B4513, #A0522D);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    margin: 1rem auto 2rem auto;
    box-shadow: 0 12px 40px rgba(139, 69, 19, 0.3);
    max-width: 1200px;
  }

  .promotion-media {
    width: 100%;
    height: 300px;
    object-fit: cover;
  }

  .promotion-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 2rem;
  }

  .promotion-title {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }

  .promotion-description {
    font-size: 1.1rem;
    opacity: 0.9;
  }

  @media (max-width: 768px) {
    .promotion-title { font-size: 1.5rem; }
    .promotion-description { font-size: 1rem; }
    .promotion-media { height: 200px; }
  }
</style>

<script>
  // --- FUNCIÓN DE PROMOCIONES SIMPLIFICADA ---
  let activePromotion = null;

  document.addEventListener("DOMContentLoaded", () => {
    loadActivePromotion();
    setInterval(loadActivePromotion, 5 * 60 * 1000); // refresca cada 5 min
  });

  async function loadActivePromotion() {
    try {
      const { data, error } = await supabase
        .from("promociones")
        .select("*")
        .eq("activa", true)
        .single();

      if (error && error.code !== "PGRST116") throw error;

      if (data) {
        const isExpired =
          data.fecha_expiracion &&
          new Date(data.fecha_expiracion) < new Date();

        if (!isExpired) {
          activePromotion = data;
          displayPromotion();
        } else {
          hidePromotion();
        }
      } else {
        hidePromotion();
      }
    } catch (error) {
      console.error("Error cargando promoción:", error);
    }
  }

  function displayPromotion() {
    const section = document.getElementById("promotion-section");
    const content = document.getElementById("promotion-content");

    if (!activePromotion) return hidePromotion();

    const isVideo = activePromotion.tipo_media === "video";
    const mediaElement = isVideo
      ? `<video src="${activePromotion.url_media}" class="promotion-media" autoplay muted loop></video>`
      : `<img src="${activePromotion.url_media}" alt="${activePromotion.titulo}" class="promotion-media">`;

    content.innerHTML = `
      ${mediaElement}
      <div class="promotion-overlay">
        <h2 class="promotion-title">${activePromotion.titulo}</h2>
        ${activePromotion.descripcion ? `<p class="promotion-description">${activePromotion.descripcion}</p>` : ""}
      </div>
    `;

    section.classList.remove("hidden");
  }

  function hidePromotion() {
    document.getElementById("promotion-section").classList.add("hidden");
  }
</script>
<!-- 🔥 FIN SECCIÓN PROMOCIÓN -->

 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9918bd61d2e701ac',t:'MTc2MDk2NTY2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
  <section class="hero-section">
   <div class="max-w-7xl mx-auto px-4 py-16">
    <div class="logo-container"><img src="https://aurical.org/images/PanuLogo.png" alt="Panu Logo" onerror="this.style.display='none';">
    </div>
    <h2 class="text-6xl font-bold mb-4">Merch and Gifts</h2>
    <p class="text-2xl opacity-90 mb-8">Calidad excepcional en cada producto!</p><!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2" id="total-products-stat">
       0
      </div>
      <div class="text-sm opacity-90">
       Productos Disponibles
      </div>
     </div>
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2" id="categories-stat">
       0
      </div>
      <div class="text-sm opacity-90">
       Categorías
      </div>
     </div>
     <div class="stats-card">
      <div class="text-3xl font-bold mb-2">
       ⭐
      </div>
      <div class="text-sm opacity-90">
       Calidad Premium!
      </div>
     </div>
    </div>
   </div>
  </section><!-- Tab Navigation -->
  <section class="bg-white shadow-sm">
   <div class="max-w-7xl mx-auto px-4">
        <div class="tab-nav flex">
            <button onclick="switchTab('gift')" id="gift-tab" class="tab-btn active flex-1 text-center font-medium"> 🎁 Gifts </button>
            <button onclick="switchTab('merch')" id="merch-tab" class="tab-btn flex-1 text-center font-medium"> 🏢 Merch (Empresarial) </button>
        </div>
    </div>
  </section><!-- Catalog Tab Content -->
    <!-- Ahora el primer contenedor corresponde a GIFTS -->
    <div id="gift-content" class="tab-content active"><!-- Advanced Filters -->
   <section class="py-6 bg-white bg-opacity-60 backdrop-filter backdrop-blur-lg shadow-sm border-b border-gray-200 border-opacity-30">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex flex-col lg:flex-row gap-4 items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-gray-800">Filtros y Herramientas</h3><!-- View Toggle -->
      <div class="flex items-center space-x-4"><span class="text-sm text-gray-600">Vista:</span>
       <div class="flex bg-stone-100 rounded-lg p-1"><button onclick="changeView('grid')" id="grid-view-btn" class="view-btn active px-3 py-2 rounded-md text-sm font-medium transition-all"> 📱 Tarjetas </button> <button onclick="changeView('list')" id="list-view-btn" class="view-btn px-3 py-2 rounded-md text-sm font-medium transition-all"> 📋 Lista </button>
       </div>
      </div>
     </div><!-- Filter Controls -->
     <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6"><!-- Categories -->
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Categoría</label> <select id="category-select" onchange="filterByCategory(this.value)" class="w-full px-3 py-2 bg-white bg-opacity-80 backdrop-filter backdrop-blur-lg border border-gray-300 border-opacity-50 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"> <option value="all">Todas las categorías</option> <option value="tazas">☕ Tazas</option> <option value="remeras">👕 Remeras</option> <option value="accesorios">🎁 Accesorios</option> <option value="otros">📦 Otros</option> </select>
      </div><!-- Price Range -->
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Rango de Precio</label> <select id="price-range" onchange="filterByPrice()" class="w-full px-3 py-2 bg-white bg-opacity-80 backdrop-filter backdrop-blur-lg border border-gray-300 border-opacity-50 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"> <option value="all">Todos los precios</option> <option value="0-50000">Hasta Gs. 50.000</option> <option value="50000-100000">Gs. 50.000 - 100.000</option> <option value="100000-200000">Gs. 100.000 - 200.000</option> <option value="200000-999999999">Más de Gs. 200.000</option> </select>
      </div><!-- Sort Options -->
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Ordenar por</label> <select id="sort-select" onchange="sortProducts()" class="w-full px-3 py-2 bg-white bg-opacity-80 backdrop-filter backdrop-blur-lg border border-gray-300 border-opacity-50 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"> <option value="newest">Más recientes</option> <option value="name-asc">Nombre A-Z</option> <option value="name-desc">Nombre Z-A</option> <option value="price-asc">Precio menor a mayor</option> <option value="price-desc">Precio mayor a menor</option> </select>
      </div><!-- Quick Actions -->
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Acciones</label>
       <div class="flex space-x-2"><button onclick="clearAllFilters()" class="flex-1 px-3 py-2 bg-white bg-opacity-60 backdrop-filter backdrop-blur-lg border border-gray-300 border-opacity-50 hover:bg-opacity-80 text-gray-700 rounded-lg text-sm font-medium transition-all"> 🔄 Limpiar </button> <button onclick="toggleFavorites()" id="favorites-btn" class="flex-1 px-3 py-2 bg-red-100 bg-opacity-60 backdrop-filter backdrop-blur-lg border border-red-300 border-opacity-50 hover:bg-opacity-80 text-red-700 rounded-lg text-sm font-medium transition-all"> ❤️ Favoritos </button>
       </div>
      </div>
     </div><!-- Quick Category Buttons -->
     <div class="flex flex-wrap justify-center gap-3" id="category-filters"><button onclick="filterByCategory('all')" class="category-btn active px-4 py-2 rounded-full font-medium bg-stone-100 text-stone-800 text-sm"> Todos </button> <button onclick="filterByCategory('tazas')" class="category-btn px-4 py-2 rounded-full font-medium bg-stone-100 text-stone-800 text-sm"> ☕ Tazas </button> <button onclick="filterByCategory('remeras')" class="category-btn px-4 py-2 rounded-full font-medium bg-stone-100 text-stone-800 text-sm"> 👕 Remeras </button> <button onclick="filterByCategory('accesorios')" class="category-btn px-4 py-2 rounded-full font-medium bg-stone-100 text-stone-800 text-sm"> 🎁 Accesorios </button> <button onclick="filterByCategory('otros')" class="category-btn px-4 py-2 rounded-full font-medium bg-stone-100 text-stone-800 text-sm"> 📦 Otros </button>
     </div>
    </div>
   </section><!-- Products Section -->
   <section class="py-12">
    <div class="max-w-7xl mx-auto px-4"><!-- Loading State -->
     <div id="loading-products" class="flex justify-center items-center py-20">
      <div class="text-center">
       <div class="loading-spinner mx-auto mb-4"></div>
       <p class="text-stone-600 text-lg">Cargando productos...</p>
      </div>
     </div><!-- No Products State -->
     <div id="no-products" class="text-center py-20 hidden">
      <div class="text-8xl mb-6">
       📦
      </div>
      <h3 class="text-2xl font-bold text-stone-700 mb-4">No hay productos disponibles</h3>
      <p class="text-stone-500 text-lg">Vuelve pronto para ver nuestros nuevos productos</p>
     </div><!-- No Search Results -->
     <div id="no-search-results" class="text-center py-20 hidden">
      <div class="text-8xl mb-6">
       🔍
      </div>
      <h3 class="text-2xl font-bold text-stone-700 mb-4">No se encontraron productos</h3>
      <p class="text-stone-500 text-lg">Intenta con otros términos de búsqueda</p><button onclick="clearSearch()" class="btn-primary text-white px-6 py-3 rounded-lg mt-4"> Ver todos los productos </button>
     </div><!-- Products Grid -->
     <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"><!-- Products will be loaded here -->
     </div>
    </div>
    </section>
    </div>
<!-- Merch Tab Content (Empresarial) -->
    <div id="merch-content" class="tab-content">
   <section class="enterprise-section py-12">
    <div class="max-w-7xl mx-auto px-4">
+     <!-- Pequeña diferencia visual para la sección empresarial -->
+     <div class="text-center mb-4"><span class="inline-block bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-medium">Sección Empresarial</span></div>
     <div class="text-center mb-12">
            <h2 class="text-4xl font-bold mb-4">� Gifts</h2>
            <p class="text-xl opacity-90 mb-8">Colección de regalos y productos especiales</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
      <div class="enterprise-card">
       <div class="text-4xl mb-4">
        📦
       </div>
       <h3 class="text-xl font-bold mb-3">Pedidos al Por Mayor</h3>
       <p class="opacity-90 mb-4">Descuentos especiales para pedidos de 50+ unidades</p>
       <ul class="text-sm opacity-80 space-y-1">
        <li>• 50-99 unidades: 10% descuento</li>
        <li>• 100-199 unidades: 15% descuento</li>
        <li>• 200+ unidades: 20% descuento</li>
       </ul>
      </div>
      <div class="enterprise-card">
       <div class="text-4xl mb-4">
        🎨
       </div>
       <h3 class="text-xl font-bold mb-3">Diseños Personalizados</h3>
       <p class="opacity-90 mb-4">Creamos diseños únicos para tu empresa</p>
       <ul class="text-sm opacity-80 space-y-1">
        <li>• Logos corporativos</li>
        <li>• Diseños exclusivos</li>
        <li>• Múltiples formatos</li>
       </ul>
      </div>
      <div class="enterprise-card">
       <div class="text-4xl mb-4">
        🚚
       </div>
       <h3 class="text-xl font-bold mb-3">Entrega Programada</h3>
       <p class="opacity-90 mb-4">Entregas coordinadas según tus necesidades</p>
       <ul class="text-sm opacity-80 space-y-1">
        <li>• Entregas programadas</li>
        <li>• Múltiples ubicaciones</li>
        <li>• Seguimiento en tiempo real</li>
       </ul>
      </div>
     </div>
     <div class="bg-white bg-opacity-10 rounded-2xl p-8 mb-8">
      <h3 class="text-2xl font-bold mb-6 text-center">📋 Solicitar Cotización Empresarial</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div><label class="block text-sm font-medium mb-2">Empresa</label> <input type="text" id="company-name" placeholder="Nombre de la empresa" class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
       </div>
       <div><label class="block text-sm font-medium mb-2">Contacto</label> <input type="text" id="contact-name" placeholder="Nombre del contacto" class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
       </div>
       <div><label class="block text-sm font-medium mb-2">Teléfono</label> <input type="tel" id="contact-phone" placeholder="+595 xxx xxx xxx" class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
       </div>
       <div><label class="block text-sm font-medium mb-2">Cantidad Estimada</label> <select id="quantity-range" class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"> <option value="">Seleccionar cantidad</option> <option value="50-99">50-99 unidades</option> <option value="100-199">100-199 unidades</option> <option value="200-499">200-499 unidades</option> <option value="500+">500+ unidades</option> </select>
       </div>
       <div class="md:col-span-2"><label class="block text-sm font-medium mb-2">Productos de Interés</label> <textarea id="product-interest" rows="3" placeholder="Describe los productos que te interesan..." class="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white placeholder-white placeholder-opacity-70 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 resize-none"></textarea>
       </div>
      </div>
      <div class="text-center mt-6"><button onclick="sendEnterpriseQuote()" class="bg-white text-gray-800 px-8 py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 transition-all"> 📱 Enviar Cotización por WhatsApp </button>
      </div>
     </div>
     <div class="text-center">
      <h3 class="text-xl font-bold mb-4">¿Necesitas más información?</h3>
      <p class="opacity-90 mb-6">Nuestro equipo empresarial está listo para ayudarte</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center"><a href="https://wa.me/595985501874?text=Hola! Me interesa información sobre compras empresariales" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all"> 📱 WhatsApp Empresarial </a> <a href="mailto:aurical@panu.org?subject=Consulta Empresarial" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-all"> 📧 Email Directo </a>
      </div>
     </div>
    </div>
   </section>
  </div><!-- Product Detail Modal -->
  <div id="product-modal" class="modal fixed inset-0 z-50 hidden">
   <div class="flex items-center justify-center min-h-screen p-4">
    <div class="modal-content rounded-2xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto">
     <div class="p-8">
      <div class="flex justify-between items-start mb-6">
       <h2 id="modal-product-name" class="text-3xl font-bold text-stone-800"></h2><button onclick="closeProductModal()" class="text-stone-500 hover:text-stone-700 text-3xl font-bold">×</button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8"><!-- Image Gallery -->
       <div>
        <div class="mb-4"><img id="modal-main-image" src="" alt="" class="w-full h-96 object-cover rounded-xl">
        </div>
        <div id="modal-gallery" class="flex space-x-2 overflow-x-auto pb-2"><!-- Gallery images will be loaded here -->
        </div>
       </div><!-- Product Info -->
       <div>
        <div class="mb-6"><span id="modal-category" class="inline-block px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium mb-4"></span>
         <div id="modal-price" class="price-tag inline-block mb-4"></div>
         <div id="modal-availability" class="mb-4"></div>
        </div>
        <div class="mb-8">
         <h3 class="text-xl font-bold text-stone-800 mb-3">Descripción</h3>
         <p id="modal-description" class="text-stone-600 leading-relaxed"></p>
        </div>
        <div class="space-y-4"><button id="modal-whatsapp-btn" onclick="contactWhatsApp()" class="w-full bg-green-500 hover:bg-green-600 text-white py-4 px-6 rounded-xl font-bold text-lg flex items-center justify-center space-x-3 transition-all"> <span>📱</span> <span>Consultar por WhatsApp</span> </button>
         <div class="text-center text-sm text-stone-500 space-y-1">
          <p>💬 Respuesta inmediata</p>
          <p>🚚 Consulta sobre envíos</p>
          <p>💳 Métodos de pago disponibles</p>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Floating Tools -->
  <div class="floating-tools"><a href="editor.html" class="tool-btn" title="Editor de Productos" style="background: rgba(222, 184, 135, 0.9); color: #1a1a1a; border-color: rgba(222, 184, 135, 0.6);"> ✏️ </a> <button onclick="scrollToTop()" class="tool-btn" title="Ir arriba"> ⬆️ </button> <button onclick="toggleComparison()" id="compare-btn" class="tool-btn" title="Comparar productos"> ⚖️ </button> <button onclick="exportCatalog()" class="tool-btn" title="Exportar catálogo"> 📄 </button> <button onclick="shareApp()" class="tool-btn" title="Compartir catálogo"> 📤 </button>
  </div><!-- WhatsApp Floating Button --> <a href="https://wa.me/595985501874?text=Hola! Me interesa consultar sobre sus productos de sublimación" target="_blank" class="whatsapp-btn" title="Contactar por WhatsApp"> 📱 </a> <!-- Comparison Panel -->
  <div id="comparison-panel" class="comparison-panel fixed bottom-0 left-0 right-0 p-4 hidden z-30">
   <div class="max-w-7xl mx-auto">
    <div class="flex items-center justify-between mb-4">
     <h3 class="text-lg font-bold text-stone-800">Comparar Productos (<span id="compare-count">0</span>/3)</h3>
     <div class="flex space-x-2"><button onclick="compareProducts()" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium"> Ver Comparación </button> <button onclick="clearComparison()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium"> Limpiar </button> <button onclick="toggleComparison()" class="text-stone-500 hover:text-stone-700 text-xl font-bold">×</button>
     </div>
    </div>
    <div id="comparison-items" class="flex space-x-4 overflow-x-auto pb-2"><!-- Comparison items will appear here -->
    </div>
   </div>
  </div><!-- Comparison Modal -->
  <div id="comparison-modal" class="modal fixed inset-0 z-50 hidden">
   <div class="flex items-center justify-center min-h-screen p-4">
    <div class="modal-content rounded-2xl shadow-2xl max-w-6xl w-full max-h-screen overflow-y-auto">
     <div class="p-8">
      <div class="flex justify-between items-center mb-6">
       <h2 class="text-3xl font-bold text-stone-800">Comparación de Productos</h2><button onclick="closeComparisonModal()" class="text-stone-500 hover:text-stone-700 text-3xl font-bold">×</button>
      </div>
      <div id="comparison-table" class="overflow-x-auto"><!-- Comparison table will be generated here -->
      </div>
     </div>
    </div>
   </div>
  </div><!-- Footer -->
  <footer class="gradient-bg text-white py-12">
   <div class="max-w-7xl mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
     <div class="text-center md:text-left">
      <div class="flex items-center justify-center md:justify-start space-x-3 mb-4"><img src="https://aurical.org/images/PanuLogo.png" alt="Panu Logo" class="w-12 h-12 rounded-full bg-white p-2" onerror="this.style.display='none';">
       <h3 class="text-2xl font-bold">Panu</h3>
      </div>
      <p class="opacity-90">Sublimaciones premium con la mejor calidad y atención personalizada.</p>
     </div>
     <div class="text-center md:text-left">
      <h4 class="text-lg font-bold mb-4">Contacto</h4>
      <div class="space-y-2 opacity-90">
       <p>📱 WhatsApp: +595 985 501 874</p>
       <p>📧 Email: aurical@panu.org</p>
       <p>📍 Ñemby, Paraguay</p>
      </div>
     </div>
     <div class="text-center md:text-left">
      <h4 class="text-lg font-bold mb-4">Horarios</h4>
      <div class="space-y-2 opacity-90">
       <p>🕒 Lunes a Viernes: 8:00 - 18:00</p>
       <p>🕒 Sábados: 8:00 - 12:00</p>
       <p>🕒 Domingos: Cerrado</p>
      </div>
     </div>
    </div>
    <div class="border-t border-white border-opacity-20 mt-8 pt-8 text-center opacity-75">
     <p>© 2024 Panu - Sublimaciones Premium. Todos los derechos reservados.</p>
     <p class="text-sm mt-2 opacity-60">v1.040 - Construido por Joel Páez y Ren_q (Alexa Ferreira)</p>
    </div>
   </div>
  </footer>
  <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://sxihojciyiypolxahoej.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4aWhvamNpeWl5cG9seGFob2VqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3Nzc3OTEsImV4cCI6MjA3NjM1Mzc5MX0.PGIGHwPmhTjpGCl-m61P2HXrSNwiR1ku8rgIshc-RUA';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // State
        let allProducts = [];
        let filteredProducts = [];
        let currentCategory = 'all';
        let currentSearchTerm = '';
        let currentPriceRange = 'all';
        let currentSort = 'newest';
        let currentView = 'grid';
        let selectedProduct = null;
        let currentSection = 'gift'; // default open tab: 'gift' or 'merch'
        let favorites = JSON.parse(localStorage.getItem('panu-favorites') || '[]');
        let comparisonList = [];
        let showFavoritesOnly = false;

        // Utilities
        function getPlaceholderImage() {
          return 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22250%22%3E%3Crect width=%22300%22 height=%22250%22 fill=%22%23f3f4f6%22/%3E%3Ctext x=%22150%22 y=%22130%22 text-anchor=%22middle%22 font-size=%2218%22 fill=%22%236b7280%22%3EImagen no disponible%3C/text%3E%3C/svg%3E';
        }
        function getCategoryIcon(category) {
          const icons = { 'tazas':'☕','remeras':'👕','accesorios':'🎁','otros':'📦' };
          return icons[category] || '📦';
        }
        function parseGallery(product) {
          if (!product) return [];
          if (Array.isArray(product.imagen_galeria)) return product.imagen_galeria;
          try { return (product.imagen_galeria && typeof product.imagen_galeria === 'string') ? JSON.parse(product.imagen_galeria) : []; }
          catch (e) { return []; }
        }

        // Rendering
        function createProductCard(product) {
          const mainImage = product.imagen_principal || getPlaceholderImage();
          const isFavorite = favorites.includes(product.id);
          const inComparison = comparisonList.some(p => p.id === product.id);
          const gallery = parseGallery(product);
          return `
            <div class="product-card rounded-xl shadow-lg overflow-hidden fade-in cursor-pointer" onclick="showProductDetail(${product.id})">
              <div class="relative">
                <img src="${mainImage}" alt="${product.nombre}" class="w-full h-64 object-cover">
                ${!product.disponible ? '<div class="unavailable-overlay absolute inset-0 rounded-xl">No Disponible</div>' : ''}
                ${gallery.length ? `<div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded-full text-xs">+${gallery.length}</div>` : ''}
                <div class="absolute top-2 left-2 flex flex-col space-y-2">
                  <button onclick="event.stopPropagation(); toggleFavorite(${product.id})" class="favorite-btn w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center ${isFavorite ? 'active' : ''}" title="${isFavorite ? 'Quitar de favoritos' : 'Añadir a favoritos'}">
                    ${isFavorite ? '❤️' : '🤍'}
                  </button>
                  <button onclick="event.stopPropagation(); toggleComparison(${product.id})" class="w-8 h-8 bg-white bg-opacity-90 rounded-full flex items-center justify-center ${inComparison ? 'bg-blue-500 text-white' : ''}" title="${inComparison ? 'Quitar de comparación' : 'Añadir a comparación'}">⚖️</button>
                </div>
              </div>
              <div class="p-6">
                <div class="mb-3">
                  <span class="inline-block px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium mb-2">${getCategoryIcon(product.categoria)} ${product.categoria}</span>
                  <h3 class="text-xl font-bold text-stone-800 line-clamp-2">${product.nombre}</h3>
                </div>
                <p class="text-stone-600 mb-4 line-clamp-2">${product.descripcion || ''}</p>
                <div class="flex justify-between items-center">
                  <div class="price-tag">Gs. ${Number(product.precio || 0).toLocaleString()}</div>
                  <button class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">Ver Detalles</button>
                </div>
              </div>
            </div>
          `;
        }
        function createProductListItem(product) {
          const mainImage = product.imagen_principal || getPlaceholderImage();
          const isFavorite = favorites.includes(product.id);
          const inComparison = comparisonList.some(p => p.id === product.id);
          return `
            <div class="product-list-item rounded-xl p-4 cursor-pointer" onclick="showProductDetail(${product.id})">
              <div class="flex items-center space-x-4">
                <img src="${mainImage}" alt="${product.nombre}" class="w-20 h-20 object-cover rounded-lg flex-shrink-0">
                <div class="flex-grow">
                  <div class="flex items-start justify-between">
                    <div>
                      <span class="inline-block px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium mb-1">${getCategoryIcon(product.categoria)} ${product.categoria}</span>
                      <h3 class="text-lg font-bold text-stone-800 mb-1">${product.nombre}</h3>
                      <p class="text-stone-600 text-sm line-clamp-2">${product.descripcion || ''}</p>
                    </div>
                    <div class="flex items-center space-x-2 ml-4">
                      <button onclick="event.stopPropagation(); toggleFavorite(${product.id})" class="favorite-btn p-2 rounded-full hover:bg-gray-100 ${isFavorite ? 'active' : ''}" title="${isFavorite ? 'Quitar de favoritos' : 'Añadir a favoritos'}">${isFavorite ? '❤️' : '🤍'}</button>
                      <button onclick="event.stopPropagation(); toggleComparison(${product.id})" class="p-2 rounded-full hover:bg-gray-100 ${inComparison ? 'bg-blue-500 text-white' : ''}" title="${inComparison ? 'Quitar de comparación' : 'Añadir a comparación'}">⚖️</button>
                      <div class="price-tag text-sm">
                          Gs. ${Number(product.precio || 0).toLocaleString()}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        function displayProducts(products) {
          const productsGrid = document.getElementById('products-grid');
          const noSearchResults = document.getElementById('no-search-results');
          if (!products || products.length === 0) {
            productsGrid.innerHTML = '';
            if (currentSearchTerm || currentCategory !== 'all' || showFavoritesOnly) noSearchResults.classList.remove('hidden');
            else noSearchResults.classList.add('hidden');
            return;
          }
          noSearchResults.classList.add('hidden');
          if (currentView === 'grid') {
            productsGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8';
            productsGrid.innerHTML = products.map(createProductCard).join('');
          } else {
            productsGrid.className = 'space-y-4';
            productsGrid.innerHTML = products.map(createProductListItem).join('');
          }
        }

        // Data
        async function loadProducts() {
          const loadingDiv = document.getElementById('loading-products');
          const noProductsDiv = document.getElementById('no-products');
          try {
            loadingDiv.classList.remove('hidden');
            noProductsDiv.classList.add('hidden');
            const { data, error } = await supabase.from('producto').select('*').order('fecha_creacion', { ascending: false });
            if (error) throw error;
            allProducts = data || [];
            loadingDiv.classList.add('hidden');
            if (!allProducts.length) noProductsDiv.classList.remove('hidden');
            applyFilters();
            updateStats();
            updateProductCount();
          } catch (err) {
            console.error('Error loading products', err);
            loadingDiv.classList.add('hidden');
            noProductsDiv.classList.remove('hidden');
          }
        }

        // Filters & sorting
        function applyFilters() {
          let filtered = [...allProducts];

          // section filter: compare product.tipo normalized to lowercase
          if (currentSection && currentSection !== 'all') {
            filtered = filtered.filter(p => ((p.tipo || '').toLowerCase() === currentSection));
          }

          // category
          if (currentCategory !== 'all') filtered = filtered.filter(p => p.categoria === currentCategory);

          // search
          if (currentSearchTerm) {
            const q = currentSearchTerm.toLowerCase();
            filtered = filtered.filter(p =>
              (p.nombre || '').toLowerCase().includes(q) ||
              (p.descripcion || '').toLowerCase().includes(q) ||
              (p.categoria || '').toLowerCase().includes(q)
            );
          }

          // price
          if (currentPriceRange !== 'all') {
            const [min, max] = currentPriceRange.split('-').map(Number);
            filtered = filtered.filter(p => Number(p.precio || 0) >= min && Number(p.precio || 0) <= max);
          }

          // favorites
          if (showFavoritesOnly) filtered = filtered.filter(p => favorites.includes(p.id));

          // sort
          filtered.sort((a, b) => {
            switch (currentSort) {
              case 'name-asc': return String(a.nombre).localeCompare(String(b.nombre));
              case 'name-desc': return String(b.nombre).localeCompare(String(a.nombre));
              case 'price-asc': return Number(a.precio) - Number(b.precio);
              case 'price-desc': return Number(b.precio) - Number(a.precio);
              case 'newest':
              default: return new Date(b.fecha_creacion) - new Date(a.fecha_creacion);
            }
          });

          filteredProducts = filtered;
          displayProducts(filteredProducts);
          updateProductCount();
        }

        // UI helpers
        function setupSearch() {
          ['search-input', 'mobile-search-input'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('input', e => {
              currentSearchTerm = e.target.value.trim();
              // sync
              ['search-input', 'mobile-search-input'].forEach(i => {
                const other = document.getElementById(i);
                if (other && other !== e.target) other.value = currentSearchTerm;
              });
              applyFilters();
            });
          });
        }
        function toggleSearch() {
          const mobile = document.getElementById('mobile-search');
          if (!mobile) return;
          mobile.classList.toggle('hidden');
          if (!mobile.classList.contains('hidden')) {
            const input = document.getElementById('mobile-search-input');
            if (input) input.focus();
          }
        }
        function clearSearch() {
          currentSearchTerm = '';
          const si = document.getElementById('search-input');
          const mi = document.getElementById('mobile-search-input');
          if (si) si.value = '';
          if (mi) mi.value = '';
          currentCategory = 'all';
          document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
          const allBtn = Array.from(document.querySelectorAll('.category-btn')).find(b => {
            const oc = b.getAttribute && b.getAttribute('onclick');
            return oc && oc.includes("filterByCategory('all')");
          });
          if (allBtn) allBtn.classList.add('active');
          applyFilters();
        }
        function filterByCategory(cat, elOrEvent) {
          currentCategory = cat;
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          // Try to mark clicked button
          let el = null;
          if (elOrEvent) {
            if (elOrEvent.target) el = elOrEvent.target;
            else if (elOrEvent instanceof Element) el = elOrEvent;
          }
          if (!el) el = document.querySelector(`.category-btn[onclick="filterByCategory('${cat}')"]`) || document.querySelector(`.category-btn[onclick="filterByCategory(\\'${cat}\\')"]`);
          if (el && el.classList) el.classList.add('active');
          applyFilters();
        }
        function filterByPrice() {
          const el = document.getElementById('price-range');
          currentPriceRange = el ? el.value : 'all';
          applyFilters();
        }
        function sortProducts() {
          const el = document.getElementById('sort-select');
          currentSort = el ? el.value : 'newest';
          applyFilters();
        }
        function changeView(view) {
          currentView = view;
          document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
          const btn = document.getElementById(view + '-view-btn');
          if (btn) btn.classList.add('active');
          displayProducts(filteredProducts);
        }
        function clearAllFilters() {
          currentCategory = 'all';
          currentSearchTerm = '';
          currentPriceRange = 'all';
          currentSort = 'newest';
          showFavoritesOnly = false;
          const si = document.getElementById('search-input');
          const mi = document.getElementById('mobile-search-input');
          if (si) si.value = '';
          if (mi) mi.value = '';
          ['category-select','price-range','sort-select'].forEach(id => {
            const e = document.getElementById(id);
            if (e) e.value = id === 'sort-select' ? 'newest' : 'all';
          });
          document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
          const allBtn = Array.from(document.querySelectorAll('.category-btn')).find(b => {
            const oc = b.getAttribute && b.getAttribute('onclick');
            return oc && oc.includes("filterByCategory('all')");
          });
          if (allBtn) allBtn.classList.add('active');
          // reset favorites button styles
          const favBtn = document.getElementById('favorites-btn');
          if (favBtn) { favBtn.classList.remove('bg-red-500','text-white'); favBtn.classList.add('bg-red-100','text-red-700'); }
          applyFilters();
        }

        // Favorites & comparison
        function toggleFavorite(id) {
          const idx = favorites.indexOf(id);
          if (idx > -1) favorites.splice(idx,1); else favorites.push(id);
          localStorage.setItem('panu-favorites', JSON.stringify(favorites));
          applyFilters();
        }
        function toggleFavorites() {
          showFavoritesOnly = !showFavoritesOnly;
          const favBtn = document.getElementById('favorites-btn');
          if (showFavoritesOnly) { favBtn.classList.remove('bg-red-100','text-red-700'); favBtn.classList.add('bg-red-500','text-white'); }
          else { favBtn.classList.remove('bg-red-500','text-white'); favBtn.classList.add('bg-red-100','text-red-700'); }
          applyFilters();
        }
        function toggleComparison(productId) {
          if (typeof productId === 'undefined') {
            const panel = document.getElementById('comparison-panel');
            if (panel) panel.classList.toggle('hidden');
            return;
          }
          const product = allProducts.find(p => p.id === productId);
          if (!product) return;
          const idx = comparisonList.findIndex(p => p.id === productId);
          if (idx > -1) comparisonList.splice(idx,1);
          else if (comparisonList.length < 3) comparisonList.push(product);
          else { showToast('Máximo 3 productos para comparar','warning'); return; }
          updateComparisonPanel();
          applyFilters();
        }
        function updateComparisonPanel() {
          const panel = document.getElementById('comparison-panel');
          const count = document.getElementById('compare-count');
          const items = document.getElementById('comparison-items');
          if (!count || !items || !panel) return;
          count.textContent = comparisonList.length;
          if (!comparisonList.length) { panel.classList.add('hidden'); items.innerHTML = ''; return; }
          panel.classList.remove('hidden');
          items.innerHTML = comparisonList.map(p => `
            <div class="flex-shrink-0 bg-white rounded-lg p-3 shadow-sm border">
              <img src="${p.imagen_principal || getPlaceholderImage()}" alt="${p.nombre}" class="w-16 h-16 object-cover rounded-lg mb-2">
              <h4 class="text-sm font-medium text-stone-800 line-clamp-2">${p.nombre}</h4>
              <p class="text-xs text-stone-600">Gs. ${Number(p.precio||0).toLocaleString()}</p>
              <button onclick="toggleComparison(${p.id})" class="mt-2 text-red-500 hover:text-red-700 text-xs">Quitar</button>
            </div>
          `).join('');
        }
        function clearComparison() { comparisonList = []; updateComparisonPanel(); applyFilters(); }
        function compareProducts() {
          if (comparisonList.length < 2) { showToast('Selecciona al menos 2 productos para comparar','warning'); return; }
          const modal = document.getElementById('comparison-modal');
          const table = document.getElementById('comparison-table');
          if (!modal || !table) return;
          table.innerHTML = `
            <table class="w-full border-collapse">
              <thead><tr class="bg-stone-100"><th class="border p-3 text-left font-bold">Característica</th>
                ${comparisonList.map(p => `<th class="border p-3 text-center"><img src="${p.imagen_principal||getPlaceholderImage()}" class="w-20 h-20 rounded-lg mx-auto mb-2"><div class="font-bold text-sm">${p.nombre}</div></th>`).join('')}
              </tr></thead>
              <tbody>
                <tr><td class="border p-3 font-medium">Precio</td>${comparisonList.map(p=>`<td class="border p-3 text-center"><div class="price-tag inline-block">Gs. ${Number(p.precio||0).toLocaleString()}</div></td>`).join('')}</tr>
                <tr class="bg-stone-50"><td class="border p-3 font-medium">Categoría</td>${comparisonList.map(p=>`<td class="border p-3 text-center"><span class="inline-block px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs">${getCategoryIcon(p.categoria)} ${p.categoria}</span></td>`).join('')}</tr>
                <tr><td class="border p-3 font-medium">Disponibilidad</td>${comparisonList.map(p=>`<td class="border p-3 text-center">${p.disponible?'<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">✅ Disponible</span>':'<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">❌ No Disponible</span>'}</td>`).join('')}</tr>
                <tr class="bg-stone-50"><td class="border p-3 font-medium">Descripción</td>${comparisonList.map(p=>`<td class="border p-3 text-sm">${p.descripcion||''}</td>`).join('')}</tr>
                <tr><td class="border p-3 font-medium">Acciones</td>${comparisonList.map(p=>`<td class="border p-3 text-center"><button onclick="showProductDetail(${p.id}); closeComparisonModal();" class="btn-primary text-white px-3 py-2 rounded-lg text-sm w-full mb-2">Ver Detalles</button><button onclick="contactWhatsAppProduct(${p.id})" class="bg-green-500 text-white px-3 py-2 rounded-lg text-sm w-full">WhatsApp</button></td>`).join('')}</tr>
              </tbody>
            </table>
          `;
          modal.classList.remove('hidden');
        }
        function closeComparisonModal(){ const m=document.getElementById('comparison-modal'); if(m) m.classList.add('hidden'); }
        function contactWhatsAppProduct(productId){ const p = allProducts.find(x=>x.id===productId); if(!p) return; const msg=`Hola! Me interesa el producto: ${p.nombre} - Gs. ${Number(p.precio||0).toLocaleString()}.`; window.open(`https://wa.me/595985501874?text=${encodeURIComponent(msg)}`,'_blank'); }

        // Product modal
        function showProductDetail(id) {
          selectedProduct = allProducts.find(p => p.id === id);
          if (!selectedProduct) return;
          const name = document.getElementById('modal-product-name');
          const cat = document.getElementById('modal-category');
          const price = document.getElementById('modal-price');
          const desc = document.getElementById('modal-description');
          const avail = document.getElementById('modal-availability');
          const mainImg = document.getElementById('modal-main-image');
          const gallery = document.getElementById('modal-gallery');
          if (name) name.textContent = selectedProduct.nombre;
          if (cat) cat.textContent = `${getCategoryIcon(selectedProduct.categoria)} ${selectedProduct.categoria}`;
          if (price) price.textContent = `Gs. ${Number(selectedProduct.precio||0).toLocaleString()}`;
          if (desc) desc.textContent = selectedProduct.descripcion || '';
          if (avail) avail.innerHTML = selectedProduct.disponible ? '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">✅ Disponible</span>' : '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">❌ No Disponible</span>';
          if (mainImg) mainImg.src = selectedProduct.imagen_principal || getPlaceholderImage();
          // gallery
          const imgs = [selectedProduct.imagen_principal || getPlaceholderImage()].concat(parseGallery(selectedProduct));
          if (gallery) {
            gallery.innerHTML = imgs.length > 1 ? imgs.map((u,i)=>`<img src="${u}" alt="Imagen ${i+1}" class="gallery-image ${i===0?'active':''}" onclick="changeMainImage('${u}', this)">`).join('') : '';
          }
          const modal = document.getElementById('product-modal');
          if (modal) modal.classList.remove('hidden');
        }
        function changeMainImage(url, el) {
          const main = document.getElementById('modal-main-image');
          if (main) main.src = url;
          document.querySelectorAll('.gallery-image').forEach(img => img.classList.remove('active'));
          if (el) el.classList.add('active');
        }
        function closeProductModal() { const modal = document.getElementById('product-modal'); if (modal) modal.classList.add('hidden'); selectedProduct = null; }
        document.addEventListener('click', (e) => {
          const pm = document.getElementById('product-modal');
          if (pm && e.target === pm) closeProductModal();
        });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeProductModal(); closeComparisonModal(); } });

        // Misc
        function contactWhatsApp() {
          if (!selectedProduct) return;
          const message = `Hola! Me interesa el producto: ${selectedProduct.nombre} - Gs. ${Number(selectedProduct.precio||0).toLocaleString()}. ¿Podrías darme más información?`;
          window.open(`https://wa.me/595985501874?text=${encodeURIComponent(message)}`, '_blank');
        }
        function updateStats() {
          const total = allProducts.length;
          const categories = new Set(allProducts.map(p => p.categoria)).size;
          const tp = document.getElementById('total-products-stat');
          const cs = document.getElementById('categories-stat');
          if (tp) tp.textContent = total;
          if (cs) cs.textContent = categories;
        }
        function updateProductCount() {
          const cnt = filteredProducts.length;
          const txt = cnt === 1 ? '1 producto' : `${cnt} productos`;
          const el = document.getElementById('product-count');
          if (el) el.textContent = txt;
        }
        function exportCatalog() {
          const rows = [['Nombre','Categoría','Precio','Descripción','Disponible'], ...filteredProducts.map(p=>[p.nombre,p.categoria,Number(p.precio||0),p.descripcion,p.disponible?'Sí':'No'])];
          const csv = rows.map(r => r.map(f => `"${String(f||'').replace(/"/g,'""')}"`).join(',')).join('\n');
          const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href = url; a.download = 'catalogo-panu.csv'; document.body.appendChild(a); a.click(); a.remove();
          showToast('Catálogo exportado exitosamente','success');
        }
        function shareApp() {
          if (navigator.share) navigator.share({title:'Panu - Sublimaciones Premium',text:'Descubre nuestro catálogo',url:window.location.href});
          else navigator.clipboard.writeText(window.location.href).then(()=> showToast('Enlace copiado al portapapeles','success'));
        }
        function showToast(message, type='info') {
          const toast = document.createElement('div');
          toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 transform translate-x-full`;
          toast.textContent = message;
          switch(type){case 'success': toast.classList.add('bg-green-500'); break; case 'warning': toast.classList.add('bg-yellow-500'); break; case 'error': toast.classList.add('bg-red-500'); break; default: toast.classList.add('bg-blue-500');}
          document.body.appendChild(toast);
          setTimeout(()=> toast.classList.remove('translate-x-full'), 50);
          setTimeout(()=> { toast.classList.add('translate-x-full'); setTimeout(()=> toast.remove(), 300); }, 3000);
        }

        // Tabs
        function switchTab(tabName) {
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          const content = document.getElementById(`${tabName}-content`);
          const btn = document.getElementById(`${tabName}-tab`);
          if (content) content.classList.add('active');
          if (btn) btn.classList.add('active');
          if (tabName === 'merch' || tabName === 'gift') { currentSection = tabName; applyFilters(); }
        }

        // Enterprise quote
        function sendEnterpriseQuote() {
          const companyName = (document.getElementById('company-name')||{}).value || '';
          const contactName = (document.getElementById('contact-name')||{}).value || '';
          const contactPhone = (document.getElementById('contact-phone')||{}).value || '';
          const quantityRange = (document.getElementById('quantity-range')||{}).value || '';
          const productInterest = (document.getElementById('product-interest')||{}).value || '';
          if (!companyName || !contactName || !contactPhone || !quantityRange || !productInterest) { showToast('Por favor completa todos los campos','warning'); return; }
          const message = `🏢 COTIZACIÓN EMPRESARIAL\nEmpresa: ${companyName}\nContacto: ${contactName}\nTeléfono: ${contactPhone}\nCantidad: ${quantityRange}\n\nProductos de interés:\n${productInterest}\n`;
          window.open(`https://wa.me/595985501874?text=${encodeURIComponent(message)}`,'_blank');
          ['company-name','contact-name','contact-phone','quantity-range','product-interest'].forEach(id => { const e = document.getElementById(id); if (e) e.value = ''; });
          showToast('Cotización enviada por WhatsApp','success');
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
          setupSearch();
          loadProducts();
          updateComparisonPanel();
          // set initial tab UI
          const initialTab = currentSection === 'merch' ? 'merch' : 'gift';
          switchTab(initialTab);
        });
  </script>

<!-- ...existing code... (closing body/html) ... -->
</body>
</html>