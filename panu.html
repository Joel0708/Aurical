<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panu Sublimaciones - Productos √önicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'beige': '#F5E6D3',
                        'beige-dark': '#E8D5B7',
                        'brown': '#8B7355',
                        'brown-dark': '#6B5B47',
                        'cream': '#FFF8F0',
                        'cream-dark': '#F5F0E8',
                        'black': '#1C1C1C',
                        'black-light': '#2D2D2D',
                        'white': '#FFFFFF',
                        'accent': '#D4AF37'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .glass-effect {
            backdrop-filter: blur(15px);
            background: rgba(248, 248, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .glass-black {
            backdrop-filter: blur(15px);
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.4);
        }
        
        .text-gradient {
            background: linear-gradient(45deg, #FFD700, #F5F5DC);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #FFD700, #000000);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #DAA520, #1a1a1a);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }
        
        .product-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.2);
        }
        
        .hero-bg {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 30%, #FFD700 70%, #F5F5DC 100%);
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
        }
        
        .status-caisy {
            background: #8B5CF6;
            color: white;
        }
        
        .status-offline {
            background: #EF4444;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #F8F8FF 0%, #FFFFFF 50%, #F5F5DC 100%);
            border: 2px solid #E6D7B8;
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
        }
    </style>
</head>
<body class="bg-beige text-black font-sans">
    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status status-offline">
        üîÑ Conectando...
    </div>

    <!-- Header -->
    <header class="bg-cream bg-opacity-95 backdrop-blur-md border-b border-brown sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <img src="./image/Aurical.svg" alt="Panu Logo" class="w-10 h-10" onerror="this.style.display='none'">
                    <div>
                        <h1 class="text-2xl font-bold text-black">Panu Sublimaciones</h1>
                        <p class="text-sm text-brown">Productos √∫nicos y personalizados</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="productCount" class="text-sm text-brown">0 productos</span>
                    <button onclick="openEditor()" class="bg-brown hover:bg-brown-dark text-cream px-4 py-2 rounded-lg transition-all font-medium">
                        üé® Editor
                    </button>
                    <a href="admin.html" class="bg-black hover:bg-black-light text-white px-4 py-2 rounded-lg transition-all font-medium">
                        üõ†Ô∏è Admin
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-cream via-beige to-brown-dark py-20">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <h2 class="text-5xl font-bold text-black mb-6">
                Sublimaci√≥n de <span class="text-accent">Alta Calidad</span>
            </h2>
            <p class="text-xl text-brown mb-8 max-w-2xl mx-auto">
                Transforma tus ideas en productos √∫nicos con nuestra tecnolog√≠a de sublimaci√≥n profesional
            </p>
            <button onclick="scrollToProducts()" class="bg-black hover:bg-black-light text-cream px-8 py-4 rounded-lg font-bold text-lg transition-all shadow-lg">
                üõçÔ∏è Ver Productos
            </button>
        </div>
    </section>

    <!-- Products Section -->
    <main class="max-w-7xl mx-auto px-6 py-16">
        <!-- Section Header -->
        <div class="text-center mb-12">
            <h3 class="text-4xl font-bold text-black mb-4">Nuestros Productos</h3>
            <p class="text-brown text-lg max-w-2xl mx-auto">
                Descubre nuestra colecci√≥n de productos personalizables con la mejor calidad de sublimaci√≥n
            </p>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
            <button onclick="filterProducts('all')" class="filter-btn active bg-brown text-cream border border-brown-dark px-6 py-3 rounded-lg font-medium transition-all hover:bg-brown-dark">
                Todos
            </button>
            <button onclick="filterProducts('Tazas')" class="filter-btn bg-cream border border-brown px-6 py-3 rounded-lg font-medium transition-all hover:bg-brown hover:text-cream text-black">
                Tazas
            </button>
            <button onclick="filterProducts('Camisetas')" class="filter-btn bg-cream border border-brown px-6 py-3 rounded-lg font-medium transition-all hover:bg-brown hover:text-cream text-black">
                Camisetas
            </button>
            <button onclick="filterProducts('Accesorios')" class="filter-btn bg-cream border border-brown px-6 py-3 rounded-lg font-medium transition-all hover:bg-brown hover:text-cream text-black">
                Accesorios
            </button>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Loading State -->
            <div class="col-span-full text-center py-16">
                <div class="text-6xl mb-4">üîÑ</div>
                <h3 class="text-2xl font-bold text-gold mb-2">Cargando productos...</h3>
                <p class="text-beige">Conectando con Caisy CMS...</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black border-t border-brown mt-20 py-12">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-xl font-bold text-cream mb-4">Panu Sublimaciones</h4>
                    <p class="text-beige">
                        Especialistas en sublimaci√≥n de alta calidad. Transformamos tus ideas en productos √∫nicos.
                    </p>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-cream mb-4">Contacto</h4>
                    <div class="space-y-2 text-beige">
                        <p>üìß panu@aurical.org</p>
                        <p>üì± +1 234 567 8900</p>
                        <p>üìç Tu Ciudad, Pa√≠s</p>
                    </div>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-cream mb-4">S√≠guenos</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="bg-brown p-3 rounded-lg hover:bg-brown-dark transition-all">üìò</a>
                        <a href="#" class="bg-brown p-3 rounded-lg hover:bg-brown-dark transition-all">üì∑</a>
                        <a href="#" class="bg-brown p-3 rounded-lg hover:bg-brown-dark transition-all">üê¶</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-brown mt-8 pt-8 text-center">
                <p class="text-beige">
                    ¬© 2024 Panu Sublimaciones. Todos los derechos reservados. 
                    <span class="text-accent">Desarrollado por Esteban Paez Building</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Product Detail Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-2xl text-black hover:text-beige-dark transition-colors">
                √ó
            </button>
            
            <div id="modalContent">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Editor Modal -->
    <div id="editorModal" class="modal">
        <div class="modal-content glass-navy" style="max-width: 1200px; max-height: 95%;">
            <button onclick="closeEditor()" class="absolute top-4 right-4 text-2xl text-beige hover:text-white transition-colors z-10">
                √ó
            </button>
            
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gradient mb-2">üé® Editor de Sublimaci√≥n</h3>
                <p class="text-navy-light">Dise√±a tu producto personalizado</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                <!-- Canvas Area -->
                <div class="lg:col-span-2">
                    <div class="glass-effect rounded-lg p-4 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-beige font-bold">√Årea de Dise√±o</h4>
                            <div class="flex gap-2">
                                <button onclick="clearCanvas()" class="glass-effect px-3 py-1 rounded text-sm hover:bg-beige hover:bg-opacity-20 transition-all">
                                    üóëÔ∏è Limpiar
                                </button>
                                <button onclick="downloadDesign()" class="btn-primary text-navy px-3 py-1 rounded text-sm">
                                    üíæ Descargar
                                </button>
                            </div>
                        </div>
                        <div class="relative bg-white rounded-lg" style="height: 400px;">
                            <canvas id="designCanvas" width="600" height="400" class="w-full h-full border-2 border-beige border-opacity-30 rounded-lg cursor-crosshair"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Tools Panel -->
                <div class="space-y-4">
                    <!-- Product Selection -->
                    <div class="glass-effect rounded-lg p-4">
                        <h4 class="text-beige font-bold mb-3">Producto Base</h4>
                        <select id="productSelect" class="w-full bg-navy text-beige p-2 rounded border border-beige border-opacity-30">
                            <option value="taza">Taza Blanca</option>
                            <option value="camiseta">Camiseta</option>
                            <option value="mouse-pad">Mouse Pad</option>
                        </select>
                    </div>
                    
                    <!-- Drawing Tools -->
                    <div class="glass-effect rounded-lg p-4">
                        <h4 class="text-beige font-bold mb-3">Herramientas</h4>
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <button onclick="setTool('brush')" class="tool-btn active glass-effect p-2 rounded text-sm hover:bg-beige hover:bg-opacity-20 transition-all">
                                üñåÔ∏è Pincel
                            </button>
                            <button onclick="setTool('eraser')" class="tool-btn glass-effect p-2 rounded text-sm hover:bg-beige hover:bg-opacity-20 transition-all">
                                üßΩ Borrador
                            </button>
                            <button onclick="setTool('text')" class="tool-btn glass-effect p-2 rounded text-sm hover:bg-beige hover:bg-opacity-20 transition-all">
                                üìù Texto
                            </button>
                            <button onclick="setTool('shape')" class="tool-btn glass-effect p-2 rounded text-sm hover:bg-beige hover:bg-opacity-20 transition-all">
                                üî∑ Formas
                            </button>
                        </div>
                        
                        <!-- Color Picker -->
                        <div class="mb-3">
                            <label class="block text-beige text-sm mb-1">Color:</label>
                            <input type="color" id="colorPicker" value="#000000" class="w-full h-8 rounded border border-beige border-opacity-30">
                        </div>
                        
                        <!-- Brush Size -->
                        <div class="mb-3">
                            <label class="block text-beige text-sm mb-1">Tama√±o: <span id="brushSizeValue">5</span>px</label>
                            <input type="range" id="brushSize" min="1" max="50" value="5" class="w-full">
                        </div>
                    </div>
                    
                    <!-- Text Tools -->
                    <div id="textTools" class="glass-effect rounded-lg p-4 hidden">
                        <h4 class="text-beige font-bold mb-3">Opciones de Texto</h4>
                        <input type="text" id="textInput" placeholder="Escribe tu texto..." class="w-full bg-navy text-beige p-2 rounded border border-beige border-opacity-30 mb-2">
                        <select id="fontSelect" class="w-full bg-navy text-beige p-2 rounded border border-beige border-opacity-30 mb-2">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Georgia">Georgia</option>
                        </select>
                        <input type="range" id="fontSize" min="12" max="72" value="24" class="w-full">
                        <label class="block text-beige text-sm">Tama√±o: <span id="fontSizeValue">24</span>px</label>
                    </div>
                    
                    <!-- Image Upload -->
                    <div class="glass-effect rounded-lg p-4">
                        <h4 class="text-beige font-bold mb-3">Subir Imagen</h4>
                        <input type="file" id="imageUpload" accept="image/*" class="w-full bg-navy text-beige p-2 rounded border border-beige border-opacity-30 text-sm">
                    </div>
                    
                    <!-- Actions -->
                    <div class="glass-effect rounded-lg p-4">
                        <h4 class="text-beige font-bold mb-3">Acciones</h4>
                        <div class="space-y-2">
                            <button onclick="saveDesign()" class="w-full btn-primary text-navy py-2 rounded font-medium">
                                üíæ Guardar Dise√±o
                            </button>
                            <button onclick="requestQuote()" class="w-full glass-effect py-2 rounded font-medium hover:bg-beige hover:bg-opacity-20 transition-all">
                                üí∞ Solicitar Cotizaci√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let allProducts = [];
        let filteredProducts = [];
        let currentFilter = 'all';
        let caisyConnected = false;

        // Helper function to extract text from Caisy rich text field (same as admin.html)
        function extractTextFromDescription(descripcion) {
            if (!descripcion) return '';
            
            // If it's already a string, return it
            if (typeof descripcion === 'string') return descripcion;
            
            // If it has json field, try to extract text from it
            if (descripcion.json) {
                try {
                    const jsonData = typeof descripcion.json === 'string' ? 
                        JSON.parse(descripcion.json) : descripcion.json;
                    
                    // Extract text from Caisy's rich text JSON structure
                    function extractTextFromNodes(nodes) {
                        if (!nodes || !Array.isArray(nodes)) return '';
                        
                        return nodes.map(node => {
                            if (node.type === 'text') return node.text || '';
                            if (node.children) return extractTextFromNodes(node.children);
                            return '';
                        }).join(' ').trim();
                    }
                    
                    if (jsonData.children) {
                        return extractTextFromNodes(jsonData.children);
                    }
                    
                    // Fallback: convert JSON to string
                    return JSON.stringify(jsonData).replace(/[{}"\[\]]/g, ' ').trim();
                } catch (error) {
                    console.log('Error parsing description JSON:', error);
                    return String(descripcion.json);
                }
            }
            
            // Fallback to string conversion
            return String(descripcion);
        }

        // Caisy configuration (same as admin.html)
        const CAISY_CONFIG = {
            endpoint: 'https://cloud.caisy.io/api/v3/e/d5020874-9338-4ce1-9f01-872741713f01/graphql',
            apiKey: 'DR4cQSjCXwdqZDs20vuKsPmGreNnSu4T'
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        // Initialize page
        async function initializePage() {
            updateConnectionStatus('connecting');
            await loadProducts();
            checkCaisyConnection();
        }

        // Check Caisy connection
        async function checkCaisyConnection() {
            try {
                const testQuery = `query { __typename }`;
                const response = await fetch(CAISY_CONFIG.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-caisy-apikey': CAISY_CONFIG.apiKey
                    },
                    body: JSON.stringify({ query: testQuery })
                });

                if (response.ok) {
                    caisyConnected = true;
                    updateConnectionStatus('caisy');
                    console.log('‚úÖ Conectado a Caisy CMS');
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                caisyConnected = false;
                updateConnectionStatus('offline');
                console.log('‚ùå Sin conexi√≥n a Caisy, modo offline');
            }
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            
            switch (status) {
                case 'connecting':
                    statusEl.className = 'connection-status status-offline';
                    statusEl.textContent = 'üîÑ Conectando...';
                    break;
                case 'caisy':
                    statusEl.className = 'connection-status status-caisy';
                    statusEl.textContent = '‚òÅÔ∏è Conectado a Caisy';
                    break;
                case 'offline':
                    statusEl.className = 'connection-status status-offline';
                    statusEl.textContent = 'üì± Modo Local';
                    break;
            }
        }

        // Load products from Caisy and localStorage
        async function loadProducts() {
            try {
                // Try to load from Caisy first
                if (caisyConnected) {
                    await loadFromCaisy();
                } else {
                    // Fallback to localStorage
                    loadFromLocalStorage();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                loadFromLocalStorage();
            }
        }

        // Load products from Caisy with better error handling and debugging
        async function loadFromCaisy() {
            try {
                console.log('üîç Conectando con blueprint "Producto" en Caisy...');
                
                // First, let's try a simple introspection query to see what's available
                const introspectionQuery = `
                    query {
                        __schema {
                            queryType {
                                fields {
                                    name
                                    type {
                                        name
                                    }
                                }
                            }
                        }
                    }
                `;

                console.log('üîç Verificando esquema disponible...');
                const introspectionResponse = await fetch(CAISY_CONFIG.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-caisy-apikey': CAISY_CONFIG.apiKey
                    },
                    body: JSON.stringify({ query: introspectionQuery })
                });

                const introspectionData = await introspectionResponse.json();
                console.log('üìã Campos disponibles:', introspectionData.data?.__schema?.queryType?.fields?.map(f => f.name));

                // Now try different possible query names
                const possibleQueries = [
                    'allProducto',
                    'Producto', 
                    'productos',
                    'allProductos',
                    'Product',
                    'allProduct'
                ];

                let successfulQuery = null;
                let productos = [];

                for (const queryName of possibleQueries) {
                    try {
                        console.log(`üîç Probando consulta: ${queryName}`);
                        
                        const testQuery = `
                            query {
                                ${queryName} {
                                    id
                                    nombre
                                    descripcion {
                                        json
                                    }
                                    precio
                                    categoria
                                    imagen_principal {
                                        src
                                    }
                                    imagenes_galeria {
                                        ... on Asset {
                                            src
                                        }
                                    }
                                    disponible
                                    fecha_creacion
                                }
                            }
                        `;

                        const testResponse = await fetch(CAISY_CONFIG.endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'x-caisy-apikey': CAISY_CONFIG.apiKey
                            },
                            body: JSON.stringify({ query: testQuery })
                        });

                        const testData = await testResponse.json();
                        
                        if (!testData.errors && testData.data && testData.data[queryName]) {
                            console.log(`‚úÖ Consulta exitosa con: ${queryName}`);
                            console.log('üì¶ Datos recibidos:', testData.data[queryName]);
                            
                            productos = Array.isArray(testData.data[queryName]) ? 
                                testData.data[queryName] : [testData.data[queryName]];
                            successfulQuery = queryName;
                            break;
                        } else if (testData.errors) {
                            console.log(`‚ùå Error con ${queryName}:`, testData.errors[0]?.message);
                        } else {
                            console.log(`‚ö†Ô∏è ${queryName} no devolvi√≥ datos`);
                        }
                    } catch (queryError) {
                        console.log(`‚ùå Error ejecutando ${queryName}:`, queryError.message);
                    }
                }

                if (!successfulQuery || productos.length === 0) {
                    console.log('‚ö†Ô∏è No se pudieron cargar productos desde Caisy');
                    showNotification('‚ö†Ô∏è No se encontraron productos en Caisy', 'warning');
                    loadFromLocalStorage();
                    return;
                }

                console.log(`‚úÖ Productos encontrados con consulta "${successfulQuery}":`, productos.length);

                // Transform Caisy data to our format
                const caisyProducts = productos.map((producto, index) => {
                    console.log(`üîÑ Procesando producto ${index + 1}:`, producto);
                    
                    return {
                        id: producto.id || `caisy_${index}`,
                        name: producto.nombre || `Producto ${index + 1}`,
                        price: parseFloat(producto.precio) || 0,
                        description: extractTextFromDescription(producto.descripcion) || 'Producto de sublimaci√≥n',
                        category: producto.categoria || 'Otros',
                        stock: producto.disponible ? 10 : 0,
                        images: [
                            ...(producto.imagen_principal?.src ? [producto.imagen_principal.src] : []),
                            ...(producto.imagenes_galeria?.map(img => img.src).filter(Boolean) || [])
                        ],
                        available: producto.disponible !== false,
                        createdAt: producto.fecha_creacion || new Date().toISOString(),
                        source: 'caisy'
                    };
                });

                console.log('üîÑ Productos transformados:', caisyProducts);

                // Merge with local products (keep local ones that aren't in Caisy)
                const localProducts = JSON.parse(localStorage.getItem('panuProducts') || '[]');
                const localOnlyProducts = localProducts.filter(local => 
                    local.source === 'local' && !caisyProducts.find(caisy => caisy.id === local.id)
                );

                allProducts = [...caisyProducts, ...localOnlyProducts];

                console.log('‚úÖ Total productos cargados:', allProducts.length);
                console.log('üìä Desde Caisy:', caisyProducts.length);
                console.log('üì± Locales mantenidos:', localOnlyProducts.length);
                
                showNotification(`‚úÖ ${caisyProducts.length} productos cargados desde Caisy`, 'success');
                applyFilter();

            } catch (error) {
                console.error('‚ùå Error completo cargando desde Caisy:', error);
                showNotification('‚ö†Ô∏è Error conectando con Caisy, usando datos locales', 'warning');
                
                // Always fall back to localStorage
                loadFromLocalStorage();
            }
        }

        // Load products from localStorage
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('panuProducts');
                if (saved) {
                    allProducts = JSON.parse(saved);
                    console.log('üì¶ Productos cargados desde localStorage:', allProducts.length);
                } else {
                    allProducts = [];
                    console.log('üì¶ No hay productos guardados');
                }
                applyFilter();
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                allProducts = [];
                applyFilter();
            }
        }

        // Filter products
        function filterProducts(category) {
            currentFilter = category;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-brown', 'text-cream');
                btn.classList.add('bg-cream', 'text-black', 'hover:bg-brown', 'hover:text-cream');
            });
            
            event.target.classList.remove('bg-cream', 'text-black', 'hover:bg-brown', 'hover:text-cream');
            event.target.classList.add('active', 'bg-brown', 'text-cream');
            
            applyFilter();
        }

        // Apply current filter
        function applyFilter() {
            if (currentFilter === 'all') {
                filteredProducts = allProducts;
            } else {
                filteredProducts = allProducts.filter(product => product.category === currentFilter);
            }
            
            renderProducts();
        }

        // Render products
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const productCount = document.getElementById('productCount');
            
            productCount.textContent = `${filteredProducts.length} productos`;
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="text-6xl mb-4">üì¶</div>
                        <h3 class="text-2xl font-bold text-beige mb-2">No hay productos disponibles</h3>
                        <p class="text-navy-light">
                            ${currentFilter === 'all' ? 'A√∫n no hay productos en el cat√°logo' : `No hay productos en la categor√≠a "${currentFilter}"`}
                        </p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredProducts.map(product => `
                <div class="product-card bg-cream border border-brown rounded-xl overflow-hidden cursor-pointer shadow-lg hover:shadow-xl transition-all" onclick="openProductModal('${product.id}')">
                    <div class="relative">
                        ${product.images && product.images.length > 0 ? `
                            <img src="${product.images[0]}" alt="${product.name}" class="w-full h-48 object-cover">
                        ` : `
                            <div class="w-full h-48 bg-gradient-to-br from-beige to-brown flex items-center justify-center">
                                <div class="text-4xl text-cream">üíé</div>
                            </div>
                        `}
                        <div class="absolute top-2 right-2 flex gap-2">
                            <span class="bg-brown text-cream px-2 py-1 rounded text-xs font-bold">
                                ${product.category}
                            </span>
                            ${product.source === 'caisy' ? `
                                <span class="bg-accent text-black px-2 py-1 rounded text-xs font-bold">
                                    ‚òÅÔ∏è Caisy
                                </span>
                            ` : ''}
                        </div>
                        ${product.stock <= 5 ? `
                            <div class="absolute top-2 left-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-bold">
                                ${product.stock <= 0 ? 'Agotado' : `√öltimas ${product.stock}`}
                            </div>
                        ` : ''}
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-black mb-2">${product.name}</h3>
                        <p class="text-brown text-sm mb-3 line-clamp-2">${product.description || 'Producto de sublimaci√≥n personalizable'}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-black">$${product.price.toFixed(2)}</span>
                            <button class="bg-black hover:bg-black-light text-cream px-4 py-2 rounded-lg text-sm font-medium transition-all">
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open product modal
        function openProductModal(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const modal = document.getElementById('productModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        ${product.images && product.images.length > 0 ? `
                            <img src="${product.images[0]}" alt="${product.name}" class="w-full rounded-lg">
                            ${product.images.length > 1 ? `
                                <div class="flex gap-2 mt-4 overflow-x-auto">
                                    ${product.images.slice(1).map(img => `
                                        <img src="${img}" alt="${product.name}" class="w-20 h-20 object-cover rounded cursor-pointer opacity-70 hover:opacity-100 transition-opacity">
                                    `).join('')}
                                </div>
                            ` : ''}
                        ` : `
                            <div class="w-full h-64 bg-gradient-to-br from-beige to-navy rounded-lg flex items-center justify-center">
                                <div class="text-6xl text-navy">üíé</div>
                            </div>
                        `}
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-4">
                            <span class="bg-beige text-navy px-3 py-1 rounded-full text-sm font-bold">
                                ${product.category}
                            </span>
                            ${product.source === 'caisy' ? `
                                <span class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm">
                                    ‚òÅÔ∏è Desde Caisy
                                </span>
                            ` : ''}
                        </div>
                        
                        <h2 class="text-3xl font-bold text-beige mb-4">${product.name}</h2>
                        
                        <p class="text-navy-light text-lg mb-6">
                            ${product.description || 'Producto de sublimaci√≥n personalizable de alta calidad.'}
                        </p>
                        
                        <div class="bg-beige bg-opacity-10 rounded-lg p-4 mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-beige font-medium">Precio:</span>
                                <span class="text-2xl font-bold text-beige">$${product.price.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-beige font-medium">Disponibilidad:</span>
                                <span class="text-navy-light">
                                    ${product.stock > 0 ? `${product.stock} en stock` : 'Agotado'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <button class="w-full btn-primary text-navy py-3 rounded-lg font-bold text-lg" ${product.stock <= 0 ? 'disabled' : ''}>
                                ${product.stock > 0 ? 'üõí Solicitar Cotizaci√≥n' : '‚ùå Agotado'}
                            </button>
                            <button onclick="shareProduct('${product.id}')" class="w-full glass-effect py-3 rounded-lg font-medium hover:bg-beige hover:bg-opacity-20 transition-all">
                                üì§ Compartir Producto
                            </button>
                        </div>
                        
                        <div class="mt-6 text-sm text-navy-light">
                            <p>üíé Sublimaci√≥n de alta calidad</p>
                            <p>üé® Personalizaci√≥n disponible</p>
                            <p>üöö Env√≠o a todo el pa√≠s</p>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        // Share product
        function shareProduct(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            if (navigator.share) {
                navigator.share({
                    title: product.name,
                    text: `Mira este producto de Panu Sublimaciones: ${product.name} - $${product.price.toFixed(2)}`,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                const text = `${product.name} - $${product.price.toFixed(2)} | Panu Sublimaciones - ${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Enlace copiado al portapapeles', 'success');
                });
            }
        }

        // Scroll to products
        function scrollToProducts() {
            document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium max-w-sm ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Editor variables
        let canvas, ctx;
        let isDrawing = false;
        let currentTool = 'brush';
        let currentColor = '#000000';
        let currentSize = 5;
        let lastX = 0;
        let lastY = 0;

        // Initialize editor
        function initializeEditor() {
            canvas = document.getElementById('designCanvas');
            ctx = canvas.getContext('2d');
            
            // Set up canvas
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Canvas event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            // Tool event listeners
            document.getElementById('colorPicker').addEventListener('change', (e) => {
                currentColor = e.target.value;
            });
            
            document.getElementById('brushSize').addEventListener('input', (e) => {
                currentSize = e.target.value;
                document.getElementById('brushSizeValue').textContent = currentSize;
            });
            
            document.getElementById('fontSize').addEventListener('input', (e) => {
                document.getElementById('fontSizeValue').textContent = e.target.value;
            });
            
            document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
            
            // Set initial background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // Open editor
        function openEditor() {
            document.getElementById('editorModal').classList.add('show');
            if (!canvas) {
                setTimeout(initializeEditor, 100);
            }
        }

        // Close editor
        function closeEditor() {
            document.getElementById('editorModal').classList.remove('show');
        }

        // Set drawing tool
        function setTool(tool) {
            currentTool = tool;
            
            // Update tool buttons
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-beige', 'bg-opacity-20', 'text-navy');
            });
            
            event.target.classList.add('active', 'bg-beige', 'bg-opacity-20', 'text-navy');
            
            // Show/hide text tools
            const textTools = document.getElementById('textTools');
            if (tool === 'text') {
                textTools.classList.remove('hidden');
            } else {
                textTools.classList.add('hidden');
            }
            
            // Change cursor
            canvas.style.cursor = tool === 'text' ? 'text' : 'crosshair';
        }

        // Start drawing
        function startDrawing(e) {
            if (currentTool === 'text') {
                addText(e);
                return;
            }
            
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        // Draw function
        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            ctx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            lastX = currentX;
            lastY = currentY;
        }

        // Stop drawing
        function stopDrawing() {
            isDrawing = false;
        }

        // Handle touch events
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        // Add text to canvas
        function addText(e) {
            const text = document.getElementById('textInput').value;
            if (!text) {
                showNotification('Escribe un texto primero', 'warning');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const font = document.getElementById('fontSelect').value;
            const size = document.getElementById('fontSize').value;
            
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = currentColor;
            ctx.font = `${size}px ${font}`;
            ctx.fillText(text, x, y);
        }

        // Handle image upload
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    // Scale image to fit canvas
                    const maxWidth = canvas.width * 0.5;
                    const maxHeight = canvas.height * 0.5;
                    
                    let { width, height } = img;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                    
                    // Draw image at center
                    const x = (canvas.width - width) / 2;
                    const y = (canvas.height - height) / 2;
                    
                    ctx.drawImage(img, x, y, width, height);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Clear canvas
        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            showNotification('Canvas limpiado', 'success');
        }

        // Download design
        function downloadDesign() {
            const link = document.createElement('a');
            link.download = 'mi-dise√±o-panu.png';
            link.href = canvas.toDataURL();
            link.click();
            showNotification('Dise√±o descargado', 'success');
        }

        // Save design
        function saveDesign() {
            const designData = canvas.toDataURL();
            const designs = JSON.parse(localStorage.getItem('panuDesigns') || '[]');
            
            const newDesign = {
                id: 'design_' + Date.now(),
                name: `Dise√±o ${designs.length + 1}`,
                data: designData,
                product: document.getElementById('productSelect').value,
                createdAt: new Date().toISOString()
            };
            
            designs.push(newDesign);
            localStorage.setItem('panuDesigns', JSON.stringify(designs));
            
            showNotification('Dise√±o guardado correctamente', 'success');
        }

        // Request quote
        function requestQuote() {
            const designData = canvas.toDataURL();
            const product = document.getElementById('productSelect').value;
            
            // Get customer info
            const customerName = document.getElementById('textInput').value || 'Cliente';
            
            // Create email content
            const subject = `Solicitud de Cotizaci√≥n - ${product} - ${customerName}`;
            const body = `Hola Panu Sublimaciones,

Me gustar√≠a solicitar una cotizaci√≥n para el siguiente producto personalizado:

Producto: ${product}
Cliente: ${customerName}
Fecha: ${new Date().toLocaleDateString()}

He adjuntado mi dise√±o personalizado. Por favor, env√≠enme informaci√≥n sobre:
- Precio del producto con mi dise√±o
- Tiempo de producci√≥n
- Opciones de env√≠o
- Cualquier recomendaci√≥n t√©cnica

Quedo atento a su respuesta.

Saludos cordiales.

---
Dise√±o creado con el Editor de Panu Sublimaciones
${window.location.href}`;

            // Create mailto link
            const mailtoLink = `mailto:panu@aurical.org?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Try to open email client
            try {
                window.open(mailtoLink, '_blank');
                showNotification('üìß Abriendo tu cliente de email para enviar la cotizaci√≥n a panu@aurical.org', 'success');
                
                // Also save the quote locally for backup
                const quotes = JSON.parse(localStorage.getItem('panuQuotes') || '[]');
                quotes.push({
                    id: 'quote_' + Date.now(),
                    design: designData,
                    product: product,
                    customerName: customerName,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                });
                localStorage.setItem('panuQuotes', JSON.stringify(quotes));
                
            } catch (error) {
                // Fallback: show contact info
                showNotification('Por favor contacta directamente a: panu@aurical.org', 'info');
                console.log('Quote data saved locally:', { designData, product, customerName });
            }
        }

        // Close modal on outside click
        document.getElementById('productModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        document.getElementById('editorModal').addEventListener('click', function(e) {
            if (e.target === this) closeEditor();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f22da532cf6246',t:'MTc2MDU2MTMxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
